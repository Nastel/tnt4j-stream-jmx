<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>PingJMX by Nastel</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>PingJMX</h1>
        <h2>Lightweight framework to stream JMX metrics</h2>

        <section id="downloads">
          <a href="https://github.com/Nastel/PingJMX/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/Nastel/PingJMX/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/Nastel/PingJMX" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="pingjmx" class="anchor" href="#pingjmx" aria-hidden="true"><span class="octicon octicon-link"></span></a>PingJMX</h1>

<p>Lightweight framework to stream JMX metrics into event sinks such as: file, socket, log4j, monitoring tools, user defined.</p>

<p>These metrics can be used to monitor health, performance and availability of your JVMs and applications.
Use PingJMX to imbed a monitoring agent within your application and monitor memory, GC activity, CPU as
well as user defined MBeans.</p>

<p>Here is what you can do with PingJMX:</p>

<ul>
<li>Periodic JVM heartbeat</li>
<li>Monitor memory utilization, GC activity, memory leaks</li>
<li>High/Low, normal vs. abnormal CPU usage</li>
<li>Monitor threading, runtime and other JVM performance metrics</li>
<li>Monitor standard and custom MBean attributes</li>
<li>Conditional actions based on MBean attribute values</li>
<li>Conditional streaming based on custom filters</li>
<li>Application state dumps on VM shutdown for diagnostics</li>
</ul>

<h1>
<a id="why-pingjmx" class="anchor" href="#why-pingjmx" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why PingJMX</h1>

<p>PingJMX provides and easy, lightweight and secure way to stream and monitor JMX metrics from within
java runtime containers.</p>

<ul>
<li>Stream JMX metrics out of the JVM container (vs. polling from outside/remote)</li>
<li>Makes it easy to monitor farms of JMVs, application servers</li>
<li>No need to enable each JVM for remote JMX, SSL, security, ports, firewalls</li>
<li>Integration with monitoring tools for alerting, pro-active monitoring (AutoPilot M6)</li>
<li>Integration with cloud analytics tools (<a href="https://www.jkoolcloud.com">https://www.jkoolcloud.com</a>)</li>
<li>Integration with log4j (via TNT4J event sinks)</li>
<li>Imbedded application state dump framework for diagnostics</li>
<li>Easily build your own extensions, monitors</li>
</ul>

<h1>
<a id="using-pingjmx" class="anchor" href="#using-pingjmx" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using PingJMX</h1>

<p>It is simple: (1) run PingJMX as a <code>-javaagent</code> or (2) imbed PingJMX code into your application.</p>

<p>Running PingJMX as javaagent:</p>

<div class="highlight highlight-java"><pre>java <span class="pl-k">-</span>javaagent<span class="pl-k">:</span>tnt4j<span class="pl-k">-</span>ping<span class="pl-k">-</span>jmx<span class="pl-k">.</span>jar<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>*:*!30000<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-stj">Dlog4j</span><span class="pl-k">.</span>configuration<span class="pl-k">=</span>file<span class="pl-k">:</span>log4j<span class="pl-k">.</span>properties <span class="pl-k">-</span><span class="pl-stj">Dtnt4j</span><span class="pl-k">.</span>config<span class="pl-k">=</span>tnt4j<span class="pl-k">.</span>properties <span class="pl-k">-</span>classpath <span class="pl-s1"><span class="pl-pds">"</span>tnt4j-ping-jmx.jar;lib/tnt4j-api-final-all.jar<span class="pl-pds">"</span></span> your<span class="pl-k">.</span>class<span class="pl-k">.</span>name your<span class="pl-k">-</span>args</pre></div>

<p>Imbed PingJMX code into your application:</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// obtain PingFactory instance</span>
<span class="pl-stj">PingFactory</span> factory <span class="pl-k">=</span> <span class="pl-stj">DefaultPingFactory</span><span class="pl-k">.</span>getInstance();
<span class="pl-c">// create an instance of the pinger that will sample mbeans</span>
<span class="pl-stj">Pinger</span> platformJmx <span class="pl-k">=</span> factory<span class="pl-k">.</span>newInstance();
<span class="pl-c">//schedule collection (ping) for given MBean filter and 30000 ms sampling period</span>
platformJmx<span class="pl-k">.</span>setSchedule(<span class="pl-stj">Pinger</span><span class="pl-c1"><span class="pl-k">.</span>JMX_FILTER_ALL</span>, <span class="pl-c1">30000</span>)<span class="pl-k">.</span>run();</pre></div>

<p><b>Note that <code>setSchedule(..).run()</code> sequence must be called to run the schedule. <code>setSchedule(..)</code> just sets the
scheduling parameters, <code>run()</code> executes the schedule.</b></p>

<p>To schedule metric collection for a specific MBean server:</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// obtain PingFactory instance</span>
<span class="pl-stj">PingFactory</span> factory <span class="pl-k">=</span> <span class="pl-stj">DefaultPingFactory</span><span class="pl-k">.</span>getInstance();
<span class="pl-c">// create an instance of the pinger that will sample mbeans</span>
<span class="pl-stj">Pinger</span> platformJmx <span class="pl-k">=</span> factory<span class="pl-k">.</span>newInstance(<span class="pl-stj">ManagementFactory</span><span class="pl-k">.</span>getPlatformMBeanServer());
<span class="pl-c">//schedule collection (ping) for given MBean filter and 30000 ms sampling period</span>
platformJmx<span class="pl-k">.</span>setSchedule(<span class="pl-stj">Pinger</span><span class="pl-c1"><span class="pl-k">.</span>JMX_FILTER_ALL</span>, <span class="pl-c1">30000</span>)<span class="pl-k">.</span>run();</pre></div>

<p>Below is an example of how to sample all registered mbean servers:</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// obtain PingFactory instance</span>
<span class="pl-stj">PingFactory</span> factory <span class="pl-k">=</span> <span class="pl-stj">DefaultPingFactory</span><span class="pl-k">.</span>getInstance();
<span class="pl-c">// find other registered mbean servers</span>
<span class="pl-st">ArrayList&lt;<span class="pl-stj">MBeanServer</span>&gt;</span> mlist <span class="pl-k">=</span> <span class="pl-stj">MBeanServerFactory</span><span class="pl-k">.</span>findMBeanServer(<span class="pl-c1">null</span>);
<span class="pl-k">for</span> (<span class="pl-stj">MBeanServer</span> server<span class="pl-k">:</span> mlist) {
    <span class="pl-stj">Pinger</span> jmxp <span class="pl-k">=</span> factory<span class="pl-k">.</span>newInstance(server);
    jmxp<span class="pl-k">.</span>setSchedule(<span class="pl-stj">Pinger</span><span class="pl-c1"><span class="pl-k">.</span>JMX_FILTER_ALL</span>, <span class="pl-c1">30000</span>)<span class="pl-k">.</span>run();
}</pre></div>

<p>Alternatively, PingJMX provides a helper class <code>PingAgent</code> that lets you schedule sampling for all registered <code>MBeanServer</code> instances.</p>

<div class="highlight highlight-java"><pre><span class="pl-stj">PingAgent</span><span class="pl-k">.</span>ping(<span class="pl-stj">Pinger</span><span class="pl-c1"><span class="pl-k">.</span>JMX_FILTER_ALL</span>, <span class="pl-c1">60000</span>, <span class="pl-stj">TimeUnit</span><span class="pl-c1"><span class="pl-k">.</span>MILLISECONDS</span>);</pre></div>

<p><b>NOTE:</b> Sampled MBean attributes and associated values are stored in a collection of <code>Snapshot</code> objects stored within <code>Activity</code> instance. Current <code>Activity</code> instance can be obtained via <code>AttributeSample</code> passed when calling listeners such as <code>Condition</code>, <code>SampleListener</code>. Snapshots can be accessed using <code>Activity.getSnapshots()</code> method call.</p>

<p><b>NOTE:</b> Sampled output is written to underlying tnt4j event sink configured in <code>tnt4j.properties</code> file. Sink destinations could be a file, socket, log4j, user defined event sink implementations. </p>

<p>For more information on TNT4J and <code>tnt4j.properties</code> see (<a href="https://github.com/Nastel/TNT4J/wiki/Getting-Started">https://github.com/Nastel/TNT4J/wiki/Getting-Started</a>).</p>

<h2>
<a id="running-pingjmx-as-standalone-app" class="anchor" href="#running-pingjmx-as-standalone-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running PingJMX as standalone app</h2>

<p>Example below runs <code>PingAgent</code> helper class as a standalone java application with a given MBean filter <code>"*:*"</code>, sampling period in milliseconds (<code>10000</code>), and time to run in milliseconds (<code>60000</code>):</p>

<div class="highlight highlight-java"><pre>java <span class="pl-k">-</span><span class="pl-stj">Dlog4j</span><span class="pl-k">.</span>configuration<span class="pl-k">=</span>file<span class="pl-k">:</span>log4j<span class="pl-k">.</span>properties <span class="pl-k">-</span><span class="pl-stj">Dorg</span><span class="pl-k">.</span>tnt4j<span class="pl-k">.</span>pingagent<span class="pl-k">.</span>trace<span class="pl-k">=</span><span class="pl-c1">true</span> <span class="pl-k">-</span>classpath <span class="pl-s1"><span class="pl-pds">"</span>tnt4j-ping-jmx.jar;lib/tnt4j-api-final-all.jar<span class="pl-pds">"</span></span> <span class="pl-stj">org.tnt4j.pingjmx<span class="pl-k">.</span>PingAgent</span> <span class="pl-s1"><span class="pl-pds">"</span>*:*<span class="pl-pds">"</span></span> <span class="pl-c1">10000</span> <span class="pl-c1">60000</span></pre></div>

<h2>
<a id="running-pingjmx-as--javaagent" class="anchor" href="#running-pingjmx-as--javaagent" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running PingJMX as -javaagent</h2>

<p>PingJMX can be invoked as a a javaagent using <code>-javaagent</code> command line:</p>

<div class="highlight highlight-java"><pre>java <span class="pl-k">-</span>javaagent<span class="pl-k">:</span>tnt4j<span class="pl-k">-</span>ping<span class="pl-k">-</span>jmx<span class="pl-k">.</span>jar<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>*:*!30000<span class="pl-pds">"</span></span> <span class="pl-k">-</span><span class="pl-stj">Dlog4j</span><span class="pl-k">.</span>configuration<span class="pl-k">=</span>file<span class="pl-k">:</span>log4j<span class="pl-k">.</span>properties <span class="pl-k">-</span><span class="pl-stj">Dtnt4j</span><span class="pl-k">.</span>config<span class="pl-k">=</span>tnt4j<span class="pl-k">.</span>properties <span class="pl-k">-</span>classpath <span class="pl-s1"><span class="pl-pds">"</span>tnt4j-ping-jmx.jar;lib/tnt4j-api-final-all.jar<span class="pl-pds">"</span></span> your<span class="pl-k">.</span>class<span class="pl-k">.</span>name your<span class="pl-k">-</span>args</pre></div>

<p>The options are <code>-javaagent:tnt4j-ping-jmx.jar="mbean-filter!sample-time-ms"</code>, classpath must include pingjmx jar files as well as locations of log4j and tnt4j configuration files.</p>

<h2>
<a id="where-do-the-streams-go" class="anchor" href="#where-do-the-streams-go" aria-hidden="true"><span class="octicon octicon-link"></span></a>Where do the streams go?</h2>

<p>PingJMX streams all collected metrics based on a scheduled interval via TNT4J event streaming framework.
All streams are written into TNT4J event sinks defined in <code>tnt4j.properties</code> file which is defined by <code>-Dtnt4j.config=tnt4j.properties</code> property. </p>

<p>Below is an example of TNT4J stream definition where all PingJMX streams are written into a socket event sink
<code>com.nastel.jkool.tnt4j.sink.SocketEventSinkFactory</code>, formatted by <code>org.tnt4j.pingjmx.format.FactNameValueFormatter</code> :</p>

<pre><code>;Stanza used for PingJMX sources
{
    source: org.tnt4j.pingjmx
    source.factory: com.nastel.jkool.tnt4j.source.SourceFactoryImpl
    source.factory.GEOADDR: NewYork
    source.factory.DATACENTER: YourDC
    source.factory.RootFQN: SERVER=?#DATACENTER=?#GEOADDR=? 

    tracker.factory: com.nastel.jkool.tnt4j.tracker.DefaultTrackerFactory
    dump.sink.factory: com.nastel.jkool.tnt4j.dump.DefaultDumpSinkFactory

    ; Event sink definition where all streams are recorded

    event.sink.factory: com.nastel.jkool.tnt4j.sink.BufferedEventSinkFactory
    event.sink.factory.EventSinkFactory: com.nastel.jkool.tnt4j.sink.SocketEventSinkFactory
    event.sink.factory.EventSinkFactory.eventSinkFactory: com.nastel.jkool.tnt4j.sink.NullEventSinkFactory
    event.sink.factory.EventSinkFactory.Host: localhost
    event.sink.factory.EventSinkFactory.Port: 6060

    ; Configure default sink filter 
    event.sink.factory.Filter: com.nastel.jkool.tnt4j.filters.EventLevelTimeFilter
    event.sink.factory.Filter.Level: TRACE

    event.formatter: org.tnt4j.pingjmx.format.FactNameValueFormatter
    tracking.selector: com.nastel.jkool.tnt4j.selector.DefaultTrackingSelector
    tracking.selector.Repository: com.nastel.jkool.tnt4j.repository.FileTokenRepository
}
</code></pre>

<p>To stream PingJMX into a log file:</p>

<pre><code>;Stanza used for PingJMX sources
{
    source: org.tnt4j.pingjmx
    source.factory: com.nastel.jkool.tnt4j.source.SourceFactoryImpl
    source.factory.GEOADDR: NewYork
    source.factory.DATACENTER: YourDC
    source.factory.RootFQN: SERVER=?#DATACENTER=?#GEOADDR=? 

    tracker.factory: com.nastel.jkool.tnt4j.tracker.DefaultTrackerFactory
    dump.sink.factory: com.nastel.jkool.tnt4j.dump.DefaultDumpSinkFactory

    ; Event sink definition where all streams are recorded
    event.sink.factory: com.nastel.jkool.tnt4j.sink.BufferedEventSinkFactory
    event.sink.factory.EventSinkFactory: com.nastel.jkool.tnt4j.sink.FileEventSinkFactory
    event.sink.factory.EventSinkFactory.FileName: MyStream.log

    ; Configure default sink filter 
    event.sink.factory.Filter: com.nastel.jkool.tnt4j.filters.EventLevelTimeFilter
    event.sink.factory.Filter.Level: TRACE

    event.formatter: org.tnt4j.pingjmx.format.FactNameValueFormatter
    tracking.selector: com.nastel.jkool.tnt4j.selector.DefaultTrackingSelector
    tracking.selector.Repository: com.nastel.jkool.tnt4j.repository.FileTokenRepository
}
</code></pre>

<p>You can write your own custom event sinks (HTTPS, HTTP, etc) and your own stream formatters without having to change PingJMX
code or your application. TNT4J comes with a set of built-in event sink implementations such as: </p>

<ul>
<li>
<code>com.nastel.jkool.tnt4j.logger.Log4JEventSinkFactory</code> -- log4j</li>
<li>
<code>com.nastel.jkool.tnt4j.sink.BufferedEventSinkFactory</code> -- buffered sink</li>
<li>
<code>com.nastel.jkool.tnt4j.sink.FileEventSinkFactory</code> - standard log file</li>
<li>
<code>com.nastel.jkool.tnt4j.sink.SocketEventSinkFactory</code> -- socket (tcp/ip)</li>
<li>
<code>com.nastel.jkool.tnt4j.sink.NullEventSinkFactory</code> -- null (empty)</li>
</ul>

<h2>
<a id="auto-generating-application-state-dump" class="anchor" href="#auto-generating-application-state-dump" aria-hidden="true"><span class="octicon octicon-link"></span></a>Auto-generating application state dump</h2>

<p>PingJMX is utilizing TNT4J state dump capability to generate application state dumps</p>

<p>(1) Dump on VM shutdown:</p>

<div class="highlight highlight-java"><pre>java <span class="pl-k">-</span><span class="pl-stj">Dtnt4j</span><span class="pl-k">.</span>dump<span class="pl-k">.</span>on<span class="pl-k">.</span>vm<span class="pl-k">.</span>shutdown<span class="pl-k">=</span><span class="pl-c1">true</span> <span class="pl-k">-</span><span class="pl-stj">Dtnt4j</span><span class="pl-k">.</span>dump<span class="pl-k">.</span>provider<span class="pl-k">.</span><span class="pl-k">default</span><span class="pl-k">=</span><span class="pl-c1">true</span> <span class="pl-k">-</span><span class="pl-stj">Dtnt4j</span><span class="pl-k">.</span>dump<span class="pl-k">.</span>folder<span class="pl-k">=</span><span class="pl-c1">.</span><span class="pl-k">/</span> <span class="pl-c1">...</span></pre></div>

<p>(2) Dump on uncaught thread exceptions:</p>

<div class="highlight highlight-java"><pre>java <span class="pl-k">-</span><span class="pl-stj">Dtnt4j</span><span class="pl-k">.</span>dump<span class="pl-k">.</span>on<span class="pl-k">.</span>exceptionn<span class="pl-k">=</span><span class="pl-c1">true</span> <span class="pl-k">-</span><span class="pl-stj">Dtnt4j</span><span class="pl-k">.</span>dump<span class="pl-k">.</span>provider<span class="pl-k">.</span><span class="pl-k">default</span><span class="pl-k">=</span><span class="pl-c1">true</span> <span class="pl-k">-</span><span class="pl-stj">Dtnt4j</span><span class="pl-k">.</span>dump<span class="pl-k">.</span>folder<span class="pl-k">=</span><span class="pl-c1">.</span><span class="pl-k">/</span> <span class="pl-c1">...</span></pre></div>

<p><code>-Dtnt4j.dump.folder=./</code> specifies the destination folder where dump (.dump) files will be created (default is current working directory).</p>

<p>By default PingJMX will generate dumps with the following info:</p>

<ul>
<li>Java Properties Dump -- <code>PropertiesDumpProvider</code>
</li>
<li>Java Runtime Dump -- <code>MXBeanDumpProvider</code>
</li>
<li>Thread Stack Dump -- <code>ThreadDumpProvider</code>
</li>
<li>Thread Deadlock Dump -- <code>ThreadDumpProvider</code>
</li>
<li>Logging Stats Dump -- <code>LoggerDumpProvider</code>
</li>
</ul>

<p>You may create your own dump providers and handlers (<a href="https://github.com/Nastel/TNT4J/wiki/Getting-Started#application-state-dumps">https://github.com/Nastel/TNT4J/wiki/Getting-Started#application-state-dumps</a>)</p>

<h2>
<a id="overriding-default-pingfactory" class="anchor" href="#overriding-default-pingfactory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overriding default <code>PingFactory</code>
</h2>

<p><code>PingFactory</code> instances are used to generate <code>Pinger</code> implementation for a specific runtime environment. PingJMX supplies pinger and ping factories for standard JVMs, JBoss,
WebSphere Application Server. You may want to override default <code>PingFactory</code> with your own or an altenative by specifying:</p>

<div class="highlight highlight-java"><pre>java <span class="pl-k">-</span><span class="pl-stj">Dorg</span><span class="pl-k">.</span>tnt4j<span class="pl-k">.</span>ping<span class="pl-k">.</span>factory<span class="pl-k">=</span><span class="pl-stj">org.tnt4j.pingjmx<span class="pl-k">.</span>PlatformPingFactory</span> <span class="pl-c1">...</span></pre></div>

<p><code>PingFactory</code> is used to generate instances of the underlying pinger implementatons (objects that provide sampling of underlying mbeans).</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// return default or user defined PingFactory implementation</span>
<span class="pl-stj">PingFactory</span> factory <span class="pl-k">=</span> <span class="pl-stj">DefaultPingFactory</span><span class="pl-k">.</span>getInstance();
<span class="pl-c1">...</span></pre></div>

<h2>
<a id="managing-sample-behavior" class="anchor" href="#managing-sample-behavior" aria-hidden="true"><span class="octicon octicon-link"></span></a>Managing Sample Behavior</h2>

<p>PingJMX provides a way to intercept sampling events such as pre, during an post for each sample run and control sample behavior. See <code>SampleListener</code> interface for more details. Applications may register more than one listener per <code>Pinger</code>. Each listener is called in registration order.
In addition to intercepting sample events, applications may want to control weather how one ore more attributes are sampled and whether the sample is reported/logged. See example below:</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// return default or user defined PingFactory implementation</span>
<span class="pl-stj">PingFactory</span> factory <span class="pl-k">=</span> <span class="pl-stj">DefaultPingFactory</span><span class="pl-k">.</span>getInstance();
<span class="pl-c">// create an instance of the pinger that will sample mbeans</span>
<span class="pl-stj">Pinger</span> platformJmx <span class="pl-k">=</span> factory<span class="pl-k">.</span>newInstance();
platformJmx<span class="pl-k">.</span>setSchedule(<span class="pl-stj">Pinger</span><span class="pl-c1"><span class="pl-k">.</span>JMX_FILTER_ALL</span>, <span class="pl-c1">30000</span>)<span class="pl-k">.</span>addListener(<span class="pl-k">new</span> <span class="pl-stj">MySampleListener</span>()))<span class="pl-k">.</span>run();</pre></div>

<p>Below is a sample of what <code>MySampleListener</code> may look like:</p>

<div class="highlight highlight-java"><pre><span class="pl-s">class</span> <span class="pl-en">MySampleListener</span> <span class="pl-s">implements</span> <span class="pl-e">SampleListener</span> {
    <span class="pl-st">@Override</span>
    <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">pre</span>(<span class="pl-stj">SampleStats</span> <span class="pl-v">stats</span>, <span class="pl-stj">Activity</span> <span class="pl-v">activity</span>) {
        <span class="pl-c">// called once per sample, begining of each sample</span>
        <span class="pl-c">// set activity to NOOP to disable further sampling</span>
        <span class="pl-c">// no other attrubute will be sampled during this sample</span>
        <span class="pl-k">if</span> (some<span class="pl-k">-</span>condition) {
            activity<span class="pl-k">.</span>setType(<span class="pl-stj">OpType</span><span class="pl-c1"><span class="pl-k">.</span>NOOP</span>);
        }
    }

    <span class="pl-st">@Override</span>
    <span class="pl-s">public</span> <span class="pl-st">boolean</span> <span class="pl-en">sample</span>(<span class="pl-stj">SampleStats</span> <span class="pl-v">stats</span>, <span class="pl-stj">AttributeSample</span> <span class="pl-v">sample</span>) {
        <span class="pl-c">// called once per sampled attribute</span>
        <span class="pl-c">// return false to skip this attribute from sampling collection</span>
        <span class="pl-k">if</span> (some<span class="pl-k">-</span>condition) {
            <span class="pl-k">return</span> <span class="pl-c1">false</span>;
        }
        <span class="pl-k">return</span> <span class="pl-c1">true</span>;
    }

    <span class="pl-st">@Override</span>
    <span class="pl-s">public</span> <span class="pl-st">void</span> <span class="pl-en">post</span>(<span class="pl-stj">SampleStats</span> <span class="pl-v">stats</span>, <span class="pl-stj">Activity</span> <span class="pl-v">activity</span>) {
        <span class="pl-c">// called once per sample, end of each sample</span>
        <span class="pl-c">// set activity to NOOP to disable sampling reporting</span>
        <span class="pl-k">if</span> (some<span class="pl-k">-</span>condition) {
            activity<span class="pl-k">.</span>setType(<span class="pl-stj">OpType</span><span class="pl-c1"><span class="pl-k">.</span>NOOP</span>);
        }
    }
}</pre></div>

<h2>
<a id="conditions-and-actions" class="anchor" href="#conditions-and-actions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conditions and Actions</h2>

<p>PingJMX allows you to associate condtions with user defined actions based on values of MBean attributes on each sampling
interval. For example, what if you wanted to setup an action when a specific mbean attribute exceeds a certain threashold?
PingJMX <code>Condition</code> and <code>AttributeAction</code> interfaces allow you to call your action at runtime every time a condition is evaluated to true. See example below:</p>

<div class="highlight highlight-java"><pre><span class="pl-c">// return default or user defined PingFactory implementation</span>
<span class="pl-stj">PingFactory</span> factory <span class="pl-k">=</span> <span class="pl-stj">DefaultPingFactory</span><span class="pl-k">.</span>getInstance();
<span class="pl-c">// create an instance of the pinger that will sample mbeans</span>
<span class="pl-stj">Pinger</span> platformJmx <span class="pl-k">=</span> factory<span class="pl-k">.</span>newInstance();
<span class="pl-c">// create a condition when ThreadCount &gt; 100</span>
<span class="pl-stj">Condition</span> myCondition <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-stj">SimpleCondition</span>(<span class="pl-s1"><span class="pl-pds">"</span>java.lang:type=Threading<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>ThreadCount<span class="pl-pds">"</span></span>, <span class="pl-c1">100</span>, <span class="pl-s1"><span class="pl-pds">"</span>&gt;<span class="pl-pds">"</span></span>);
<span class="pl-c">//schedule collection (ping) for given MBean filter and 30000 ms sampling period</span>
platformJmx<span class="pl-k">.</span>setSchedule(<span class="pl-stj">Pinger</span><span class="pl-c1"><span class="pl-k">.</span>JMX_FILTER_ALL</span>, <span class="pl-c1">30000</span>)<span class="pl-k">.</span>register(myCondition, <span class="pl-k">new</span> <span class="pl-stj">MyAttributeAction</span>())<span class="pl-k">.</span>run();</pre></div>

<p>Below is a sample of what <code>MyAttributeAction</code> may look like:</p>

<div class="highlight highlight-java"><pre><span class="pl-s">public</span> <span class="pl-s">class</span> <span class="pl-en">MyAttributeAction</span> <span class="pl-s">implements</span> <span class="pl-e">AttributeAction</span> {
    <span class="pl-st">@Override</span>
    <span class="pl-s">public</span> <span class="pl-stj">Object</span> <span class="pl-en">action</span>(<span class="pl-stj">Condition</span> <span class="pl-v">cond</span>, <span class="pl-stj">AttributeSample</span> <span class="pl-v">sample</span>) {
        <span class="pl-stj">Activity</span> activity <span class="pl-k">=</span> sample<span class="pl-k">.</span>getActivity();
        <span class="pl-st">Collection&lt;<span class="pl-stj">Snapshot</span>&gt;</span> metrics <span class="pl-k">=</span> activity<span class="pl-k">.</span>getSnapshots();
        <span class="pl-stj">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(<span class="pl-s1"><span class="pl-pds">"</span>Myaction called with value=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> sample<span class="pl-k">.</span>get()
            <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>, age.usec=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> sample<span class="pl-k">.</span>ageUsec()
            <span class="pl-k">+</span> <span class="pl-s1"><span class="pl-pds">"</span>, count=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> metrics<span class="pl-k">.</span>size());
        <span class="pl-k">return</span> <span class="pl-c1">null</span>;
    }
}</pre></div>

<h1>
<a id="project-dependencies" class="anchor" href="#project-dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project Dependencies</h1>

<p>PingJMX requires the following:</p>

<ul>
<li>JDK 1.6+</li>
<li>TNT4J (<a href="https://github.com/Nastel/TNT4J">https://github.com/Nastel/TNT4J</a>)</li>
</ul>

<h1>
<a id="available-integrations" class="anchor" href="#available-integrations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Available Integrations</h1>

<ul>
<li>TNT4J (<a href="https://github.com/Nastel/TNT4J">https://github.com/Nastel/TNT4J</a>)</li>
<li>Log4J (<a href="http://logging.apache.org/log4j/1.2/">http://logging.apache.org/log4j/1.2/</a>)</li>
<li>jkoolcloud.com (<a href="https://www.jkoolcloud.com">https://www.jkoolcloud.com</a>)</li>
<li>AutoPilot M6 (<a href="http://www.nastel.com/products/autopilot-m6.html">http://www.nastel.com/products/autopilot-m6.html</a>)</li>
</ul>
      </section>
    </div>

    
  </body>
</html>